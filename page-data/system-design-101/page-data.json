{"componentChunkName":"component---src-templates-blog-post-js","path":"/system-design-101/","result":{"data":{"site":{"siteMetadata":{"title":"🥷's blog"}},"markdownRemark":{"id":"50caf298-0738-52ab-9799-10a6a28cd5c7","excerpt":"Chào mọi người mình đi phỏng vấn căng thẳng, 3 nhân vật chính sau đây: Databases Phần 1 👨‍🦳: Anh cho chú cái DB này chú phân tích xem?  👨‍🔧: Ok anh, có 3…","html":"<p>Chào mọi người mình đi phỏng vấn căng thẳng, 3 nhân vật chính sau đây:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- 👨‍🦳: Bác Senior Solution\n- 👳‍♂️: Anh Senior Engineer\n- 👨‍🔧: Mình Dev đua đòi thích đủ thứ.</code></pre></div>\n<h2>Databases</h2>\n<h3>Phần 1</h3>\n<p>👨‍🦳: Anh cho chú cái DB này chú phân tích xem?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 401px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/94d8af5aab2cc3cb62f9895fed1d4dd0/9144d/system-design-db-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5klEQVQY012PwUrEMBRF+8m6cOXStYvxG0R0oS4cEIQKjuBCyGIgLUQSWhoTmEJbTTLzatrkDVOdhXO4q8c9cF8ymy/u3paj9+OeEAIAMMaklJxzrTUixhgR4xDwnl5fLc+0tYiYHD2Qixdqutat1845a23f92VZZlmGiMYYSikAWGt/YCOkPp5n5+/q9dPs5Nnlze3TM/5nGAbOeZqmhJC6rmOM3vsYxi+3OXnMTxclWbmdjBinHAIAVVU1TbPf/If8BtbCOB2SA/W313VdnudFUSilhBB2+jCEwIXgH2ylpOC8adst2lgTTRLviVQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Databases\"\n        title=\"Databases\"\n        src=\"/blog/static/94d8af5aab2cc3cb62f9895fed1d4dd0/9144d/system-design-db-1.png\"\n        srcset=\"/blog/static/94d8af5aab2cc3cb62f9895fed1d4dd0/c26ae/system-design-db-1.png 158w,\n/blog/static/94d8af5aab2cc3cb62f9895fed1d4dd0/6bdcf/system-design-db-1.png 315w,\n/blog/static/94d8af5aab2cc3cb62f9895fed1d4dd0/9144d/system-design-db-1.png 401w\"\n        sizes=\"(max-width: 401px) 100vw, 401px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>👨‍🔧: Ok anh, có 3 thứ chúng ta cần phải đề cập ở đây:</p>\n<ul>\n<li>Thứ 1 cái DB của anh mà ngỏm tắt điện cả hệ thống rồi.</li>\n<li>Thứ 2 cái Server App của anh mà nó crashed thì cũng tắt điện.</li>\n<li>Thứ 3 theo lý thuyết anh có cái DB mà ko biết cái máy chứa nó I/O best cỡ nào mà cứ đè ra đọc ghi lia lịa. DB là một cô nàng xinh đẹp mà anh cứ i/o lia lịa thì em nó tắt thở mất thôi. Trước hết chúng ta phải thêm 1 DB nữa để backup.</li>\n</ul>\n<blockquote>\n<p>Chúng ta sẽ dùng <code class=\"language-text\">master-slave pattern</code> để giải quyết vấn đề này</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 479px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/3a93d197c7dccab8b1cce82166956b16/a9b70/system-design-1-ms.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBUlEQVQY05WQzUrEQBCE86TefQVvvoOCp/UFRBAC4kkU1h8iRDGLYRcx/iWZJGNvsjPZdnoyLRtUFsnF79CHpqqgyuP/4PrzJGDn8sCfXXsDCueGnt9m+7mMXsSm/7h39+E5g9x1f8y2Zz3FOWJumXnZaoXm6CG7yWpv//x2+i7YdcYYIrLWZlkmhEjTNM/z3raKHifB4WQESKppnpOkSt9QLbyN0fHp/YzJKK3btlVKRVEEAGVZxnGMiFprVc+3TyZbZ0nwKp1Bsh0asl3nja8uKinXqxJRGIZBECAiM9u+lD+tdsNcov2ZbcXAYABQFEVd1wBgjGHmhVJVIZo5gJRE9Kv8AvNPjMP0zqpUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Databases\"\n        title=\"Databases\"\n        src=\"/blog/static/3a93d197c7dccab8b1cce82166956b16/a9b70/system-design-1-ms.png\"\n        srcset=\"/blog/static/3a93d197c7dccab8b1cce82166956b16/c26ae/system-design-1-ms.png 158w,\n/blog/static/3a93d197c7dccab8b1cce82166956b16/6bdcf/system-design-1-ms.png 315w,\n/blog/static/3a93d197c7dccab8b1cce82166956b16/a9b70/system-design-1-ms.png 479w\"\n        sizes=\"(max-width: 479px) 100vw, 479px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Với cách này chúng ta sẽ đạt đc 3 tiêu chí <code class=\"language-text\">system availability, protection against data loss, and performance gain</code>.</p>\n<blockquote>\n<p>Ok! để cải thiện khi hệ thống scale lên đột thì <code class=\"language-text\">Separate of concern</code> là một ý tưởng ko tồi. Để một cái master làm WRITE rồi cho 2 con slave để READ</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 487px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/7771224405ac9040d63f61d5db23a87e/7b439/system-design-2-ms.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.59493670886076%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiUlEQVQoz52SzYsUMRDF8x+LF49evXgUBEXEk18HL4J7GEd3QUVwlFFZZ5me7kwyu20y66Q7SSedzkdJd8OwqKzoO9XlV6/qVSH4F6WUAMBaMZs/acw5+isQQuCcd10HAHGAD3N8882DKSGXwTFGrbWUEuP1TtS6MVLpYNT9t8trU/b4RCBI8XfGe59S8t43TTNMCwAOoBsKwMLcfbcoKoOmX1aQYggxhAAASilCCGOsKApjjLUWACrrH83vHa1fxd6ob2CUTDGiWy8/eqOVbrTWzrksyyilfXuMy7JknBtZvV/Sqy+Wd+Ys35wWqxXG6+35jwSAvh4f72McRSmdTCaEkBACY/xsQ8926sZR9rwQrXOc891O1HUdU/o1sLZtGWPb7bYaZK0ZT7RYfCNrvLeRlYoxoouefSzO7UkhxLjzyMQY07Aw12y6uF3KU3T5haWUIYQ8zymlffjWgncPP2TXD2dPTxj64xuNAgDvvbsg2zoI3bNP+MpBdoBr9B/vuSm/v559djH9BKRhqv1KNdw3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Databases\"\n        title=\"Databases\"\n        src=\"/blog/static/7771224405ac9040d63f61d5db23a87e/7b439/system-design-2-ms.png\"\n        srcset=\"/blog/static/7771224405ac9040d63f61d5db23a87e/c26ae/system-design-2-ms.png 158w,\n/blog/static/7771224405ac9040d63f61d5db23a87e/6bdcf/system-design-2-ms.png 315w,\n/blog/static/7771224405ac9040d63f61d5db23a87e/7b439/system-design-2-ms.png 487w\"\n        sizes=\"(max-width: 487px) 100vw, 487px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>👨‍🦳: Vậy lỡ con Master tạch luôn thì sao?</p>\n<p>👨‍🔧: Mà để chắc ăn trong trường hợp wrong Query, file system isse ở production thì nên có 2 con master chạy song song và các hệ thống vệ tinh slave chạy cheo nó. <code class=\"language-text\">Backup of backup</code>.</p>\n<p>Thì khuyết điểm của trò này: là dữ liệu nó sẽ có một độ trễ nhất định khi gặp sự cố. Nhưng đảm bảo được tính liên tục và bảo toàn. Giống như Linkekin đôi khi ghi vẹo vào rồi, mà F5 nó ko lên cái update. Kiểu vậy, nhưng ở nhưng bài toán chấp nhận lag kiểu này vẫn ok.</p>\n<p>👨‍🦳: … Bác hỏi hỏi …?</p>\n<p>👳‍♂️: … làm sao code cái này, làm sao code cái kia, khi xài Nodejs xài thư viện gì… 🥶</p>\n<p>👨‍🔧: … mình bí khá nhiều 😂</p>\n<h3>Phần 2</h3>\n<p>👨‍🦳: Bây giờ giả sử một table có 10k nhân viên, hay 10k người mua hàng và mỗi row có nhiều columns, thế theo chú thì điều này có vấn đề gì không?</p>\n<p>👨‍🔧: …một table mà nhiều row thì giống như một cái từ điển có nhiều trang tùm lum tè le vậy, trước hết để giải quyết vấn đề tìm hiệu quả thì phải <code class=\"language-text\">index</code>. Trong ngày đẹp trời doanh nghiệp yêu cầu user cập nhật CMND để lấy Voucher trong vòng một ngày chẳng hạn điều này làm hệ thống sẽ quá tải khi xử lý 10k người. Để ghi được vào 1 row. Trước hết là tìm và sau đó là ghi. <code class=\"language-text\">TÌM</code>, <code class=\"language-text\">GHI</code>. Một table mà nhiều column thì mỗi lần tìm Operation này sẽ pull 1 đống dữ liệu không cần thiết. Nó làm hao phí <code class=\"language-text\">CPU, IO, NETWORK</code>. Trước hết là phải làm sao cắt cái table đó ra cho hiệu quả trước.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&gt; Horizontal partitioning</code></pre></div>\n<ul>\n<li>Nhìn vô bản chất <code class=\"language-text\">Employee</code> hay <code class=\"language-text\">Customer</code> thì tạm chia đại theo Vùng <code class=\"language-text\">Employee.country</code> as <code class=\"language-text\">China</code>, <code class=\"language-text\">Vietnam</code>… Khi chia nhỏ ra để trị thì size bài toán đã nhỏ hơn. Bây giờ sẽ đẩy về từng cluster để chia nhỏ bài toán I/O.</li>\n<li>Tổng số I/O 1 chỗ bằng M thì khi chia ra M/n. Chiến thuật chia càng hiệu quả thì càng đỡ chi phí.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 335px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/b45f5666e52878071df0259afab7d68f/c0051/system-design-hp.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.72151898734178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZklEQVQoz22SWW+jMBSF+f//ZkZ96ZJJk7AHEraEJdMCxrFNwexbqgZGoa3Uh/l0H66vdKxzfM1MP+i6DgAAZ4IgiKIIfgMACMMQ/iAMQ+Y6M47jNE11XUMIKaVZlvm+TwihlKZpSinFGAdBkGVZkiTpjG3bjKqqmqaZppkkCaWUEFJV1e2WKKKUVlVVlmVVVWmSnCGs67ooirIsi6K4id9nhmEYx7Gq6+iMaJ5nReGHIXl7o3meZhnNcxzHAQBZUSSUplmWUGqfTsxX3Nl2n+fpXu08p/ccrCrlwew8p3XtznNyyyA7pT+5jXPsPKc6mGS/Y/q+H4bhMgwf03RB52rx2ApcL3Dk8b7crDqBa3m2E7hi/Rw/PfQi33Bsy9+K3v26ZdZ13TJNiEnpv1bLRSNwncChx/tis2oFruHZVuCy9TN+euhEvubZZq63u9/M+Mn1Ok3TJSbFetmqcq/KePWnlPhOlVtF6lQ5FzmyXva7bbMVW0VqZIE+PXxlHqdb5rLN9qeNFShHoEjWs/ZXPISKFWwPobI/CZK1OgLV8mUrVIwX0XwRGIwxQihJk6ZqcHHeRqKBdJPovMepQDGwriPNwLoSbnmPM4mhnfc60nSkrV8XjGVZruvatp0mKcqgOostYvAuuwOKiXUDaSbW1XAreJxFDP28N5BmoD37svi2Pa8qbd4Ef7OL5B2UN85S8nkVSAqQ1EgWXznWXalQVkJxnkg38effvM4P9v5xQSWEJcD1OW5x3OC4xbd+blAF4xaTBsUNhgVIm4SZ/od9tCVB5Dme3bCyJFumtVlvePbr6Drup9l/Ax3lPksHinsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Databases\"\n        title=\"Databases\"\n        src=\"/blog/static/b45f5666e52878071df0259afab7d68f/c0051/system-design-hp.png\"\n        srcset=\"/blog/static/b45f5666e52878071df0259afab7d68f/c26ae/system-design-hp.png 158w,\n/blog/static/b45f5666e52878071df0259afab7d68f/6bdcf/system-design-hp.png 315w,\n/blog/static/b45f5666e52878071df0259afab7d68f/c0051/system-design-hp.png 335w\"\n        sizes=\"(max-width: 335px) 100vw, 335px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&gt; Vertical partitioning</code></pre></div>\n<ul>\n<li>\n<p>Do table có nhiều column và có những column hay thay đổi, và có nhiều column rất ít thay đổi với chiến thuật này thì chia ra 2 bảng dành cho <code class=\"language-text\">Employee[id,org,salary]</code>, <code class=\"language-text\">Employee[id,picture]</code>, <code class=\"language-text\">Employee[id,name,email]</code></p>\n<blockquote>\n<p>Partitioning improves your database availability and performance.</p>\n</blockquote>\n</li>\n</ul>\n<p>👨‍🦳: Thế cậu có biết gì về sharding ko?</p>\n<p>👨‍🔧: …lục lọi trong ký ức, dkm mình dạo này code frontend nhiều quá lú rồi. Em không nhớ mà theo lý thuyết <code class=\"language-text\">sharding</code> nó là bản nâng cấp của <code class=\"language-text\">horizontal partitioning</code>. Sharding sẽ store dữ liệu ở nơi vẹo nào cũng đc, không nhất thiết phải cũng <code class=\"language-text\">server</code>. Nó chia data ra nhiều server khác nhau và tạo ra nhiều <code class=\"language-text\">overhead</code> hơn.</p>\n<blockquote>\n<p>Algorithmic sharding, Dynamic sharding</p>\n</blockquote>\n<p>👨‍🔧: Em cũng không rành cái này lắm 😂</p>\n<h2>Performnace</h2>\n<h3>Phần 3</h3>\n<p>👨‍🦳: Ok, no worry! (bác cúi xuống ghi ghi cái gì đó). Ok! i’m done. Ravik please!</p>\n<p>👳‍♂️: Ok, Khan i have question for you 🗣. Bạn có xài caching framework gì không?</p>\n<p>👨‍🔧: Caching? Framework? 🙄🙄😶😶😶😑</p>\n<p>👨‍🔧: Ok, trước hết chúng ta sẽ nói tại sao caching. Thì tạm chia làm 2 loại không gian và thời gian. Các yếu tố ảnh hưởng đến thời gian có thể hiểu là <code class=\"language-text\">Tốc độ IO, Tốc độ xử lý thuật toán, Tốc độ mạng, Tốc độ encrypt, tốc độ decrypt ..</code></p>\n<p>👨‍🔧: Nói chung tạm gọi T là tổng hợp các operations có thể ảnh hưởng đến biến số thời gian để từ khi yêu cầu và xử lý được chấp thuận. Nếu một hệ thống mà không có cache về mặt cơ bản là ăn <code class=\"language-text\">shit</code>. Mà cache ở đâu thì lại tùy. Thường thì em dùm <code class=\"language-text\">Redis</code> và cache trên <code class=\"language-text\">RAM</code>. Em cũng muốn cache trên <code class=\"language-text\">CPU,L1,L2</code> mà méo biết làm. Túm lại cache trên <code class=\"language-text\">RAM</code> vì <code class=\"language-text\">IO</code> của <code class=\"language-text\">RAM</code> nhanh hơn <code class=\"language-text\">IO</code> của <code class=\"language-text\">Disk</code>. Còn trade-off là solution này ngốn <code class=\"language-text\">RAM</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 325px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/1e673ec2518bdf815397466b19f342a4/ff46a/caching.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 111.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsTAAALEwEAmpwYAAACh0lEQVQ4y41Ty04TURg+G+MTuPFFiI+ALmShC/UJVIS6IHGpMTEBVKAJgaghukFECaTItTQa5eJIKkqh7bSdtpBOR9Kp087MuU1nzjHTytjUDvKtTv5zvv/y/d8B/cvbt15/uvliIRCKftiJc84dxrgPWP0qXTp6szOwfSiA3rB0fXTiduDypdnU0o7IbQsT6gdCLUbhQFjqGIneey+B3rdb4+FIJBTs7J9c+Z6yoFHVDT/ohokq6nA4fSEYf7QmA+ngcGFpdXhkfFP4+quq8xPRmMcg9mZeV3QK7Fotn8sl4vsVTWuZzW9s7xZ4J3Yslaqq6XQ6kUgoiiLLciqVkiRJlmVFUURRLBQKnHPbcXnAlbcOL0utVoMQmqZpWRalFGOMECKEYIwhhJRSrwvAmsBPDcYdxhk46YUL+1im5rgbctsm0LQJcmxCDN2i5F9V/mVybjGWYUwDQ5EfgRmh+2W4bzn2OZaqO+zPUgyTaIezDlW9NTUUjaTlu3NPJ6MC6FnN3Bid6A50XZxJhoSYQxDCWNM0hHA2mymJY7lchhCKEIQQIkywXn4wL3YEM33zBdD77stYeC0SGu4cnFqMxhvkarW6t7cvCEIul1PVckNwhJAJkUPM6Wix8/n+sy0FiNn8XGhx8HHw4/qGphueQyzLqlQqCOG2nrFsVxTAHFspytmsBE2zxWGNbbeQGWONyV21mx3WUgFBiCH017ydw7xSZU0r1w3vtzbgl5aW1IOp6W/3H5qS9LfWf8nMtjnnu0+Gps+df3Xm7MadHi94CrLjcM5Lu7GVq9eWu64U1ze84CnabsrSltOe3BCmVCq5/zkeVxSlKBdTovjz6CifzyeTSYxxM/k3h/3IpSerH6YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cache\"\n        title=\"Cache\"\n        src=\"/blog/static/1e673ec2518bdf815397466b19f342a4/ff46a/caching.png\"\n        srcset=\"/blog/static/1e673ec2518bdf815397466b19f342a4/c26ae/caching.png 158w,\n/blog/static/1e673ec2518bdf815397466b19f342a4/6bdcf/caching.png 315w,\n/blog/static/1e673ec2518bdf815397466b19f342a4/ff46a/caching.png 325w\"\n        sizes=\"(max-width: 325px) 100vw, 325px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>👳‍♂️: Vậy bạn xài Redis à, bạn có thể nói tôi là bạn khai báo như thế nào trong Nodejs ko?</p>\n<p>👨‍🔧: (Lúc này hơi hoảng) 🤕 móa chả nhớ. Em mới xài nó với PHP chưa code nodejs bao giờ</p>\n<p>👳‍♂️: Bạn nói 3 năm kinh nghiệm Nodejs mà chưa xài Redis với Node bao giờ à? 🤬</p>\n<p>👨‍🔧: …😫</p>\n<p>👨‍🦳: Ok, no worry! Thế bên PHP mày xài cái gì cũng Redis à?</p>\n<p>👨‍🔧: Đúng rồi anh, cũng redis mà em xài Framwork, nó đc config sẵn.</p>\n<p>👨‍🦳: Ok! vậy nó xài thế nào?</p>\n<p>👨‍🔧: Vắt não, thực sự PHP cũng méo nhớ làm sao lại lôi lý thuyết ra chém tiếp</p>\n<p>👨‍🔧: Nói về <code class=\"language-text\">caching</code> thì chủ yếu là bàn về <code class=\"language-text\">stragegy</code> thường là ở phía <code class=\"language-text\">backend</code> toàn là mấy cục data và chi phí ghi i/o trên disk nó cao hơn. Nên những thứ cần tối ưu I/O thay vì nhào vô server lụm lụm lụm. Thì cache bố đâu đó gần nhà gọi cho lẹ. Ý em nói gần nhà là <code class=\"language-text\">CDN</code></p>\n<p>👨‍🦳: Khoan mày nói là <code class=\"language-text\">strategy</code> ý mày là sao, mày xài strategy gì rồi?</p>\n<p>👨‍🔧: Chém cái vẹo gì cũng không nhớ nữa …</p>\n<blockquote>\n<p>First in first out, Least recently used, Least frequently used</p>\n</blockquote>\n<p>👨‍🔧: Trong các chiến thuật về cache thì <code class=\"language-text\">caching level</code>. Như mấy cái <code class=\"language-text\">HTML</code> kiểu <code class=\"language-text\">Skeleton</code> ít thay đổi, hay mấy cái JSON config em cache bố nó ở client cho lẹ. Còn mấy cái static thì dùng <code class=\"language-text\">cdn</code> cho gần nhà user giảm tải thời gian package traveling. Với mấy cái web nặng nhất là cái hình. Để gần nhà user là win 80%. Còn PHP dự án trước em làm đa số là cache ở Server cái dự án do nó đưa logic về phía DB xử lý nhiều và chi phí tốn nên PHP có có sẵn cơ chế cache cái file đó. Em cũng không đi sâu vào.</p>\n<blockquote>\n<p>client cache, cdn cache, server cache.</p>\n</blockquote>\n<p>👳‍♂️: Gì cache ở phía <code class=\"language-text\">Server</code> à, vậy mốt muốn <code class=\"language-text\">scale</code> lên <code class=\"language-text\">3,4 node</code> thì sao?</p>\n<p>👨‍🔧: Vâng cái này, nó bị issue là <code class=\"language-text\">server</code> nó <code class=\"language-text\">statefull</code> mịa nó rồi, scale lên 3,4 node chắc ăn shit quá? Mà thực ra nếu con <code class=\"language-text\">load balancer</code> nó tự điều hướng theo user request có điều kiện thì cũng ổn. Còn chơi <code class=\"language-text\">RoundRobin</code> thì chắc cache nó bị  <code class=\"language-text\">cache miss problems</code>.</p>\n<p>👳‍♂️: Thế sao không đặt một con Node làm Cache chung cho hết?</p>\n<p>👨‍🔧: Vâng cái này, cũng vã lắm tụi em chạy feature thấy mẹ time đâu mà tái cấu trúc lại. Với đặt một con cache chung thì lại lòi ra <code class=\"language-text\">Single point of Dead</code> con cache có thể bị <code class=\"language-text\">bottleneck</code> bị <code class=\"language-text\">die</code>.</p>\n<p>👳‍♂️: … 😣</p>\n<p>👨‍🔧: cách tiếp cận về caching thì có 3 kiểu:</p>\n<ul>\n<li>Cache-aside pattern: <a href=\"https://codeahoy.com/2017/08/11/caching-strategies-and-how-to-choose-the-right-one/\">https://codeahoy.com/2017/08/11/caching-strategies-and-how-to-choose-the-right-one/</a></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/c6a2425e60d48e817d76a0be14bf785d/5e3a3/cache-aside.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC8UlEQVQoz3WQXUhTcRjGn7OVYel0c+qc9CWlc4cYZYvCxMoiaSBUF3UhK7G51i5CTXckA49BwbLm6MPt6Nx0mjP6MJIII9OKoIu6CSQt3NGd2ULRFIPU6T+mXuYLP5736sfzvgCQAUADYBuA3QBorI790BeqVT2PsyDw6X/K7CB4UuPHo8sBeA9NYq2hlhGBQoqIggyUlFXg5tUO6gU7gK6i2egm+dxjbmN42pX6t8YGgjoQam2heDWVFMSlMUAuIPUoAQJEGrmyxs85KEIaQIgzapF0Fo+lPjw1Dm/eJPVf34YqCaK7kyFpVohErrjNcCBJ3Byfur89R6V+t1nFFX3UuqVzE5yYkCbZQk8/6RS/HOqF9/Ak1IywgiUAtUVYBsQB8bxTJCZloHTbAbavLMbaX6G403sljpBnIFOlkvYz3bnX0vpNZQU2JZv1GuyuN1TXwSloKnjQERETENGrRISYdwKEAUq+dkma+6pk/kc+UU8Hi+95RxRDJ05mPQNk96VIskcjNnLVp/P7qBlXI0INDgQdHFSWIGhmpSUWvWmXllqUpl8+jfX34z3aYV8hRp1dGPU4o8Y9LUqhyISB6mx01AEfzDoIhksQrtdi1s2BtDGovvEemRbBQDOBV2qLcBtLXBRZckQ+DhJ2q+767CRqorFuZ8hu3/3j9On0wWPHMoYKCtK/6XQZg/n5qsGjR9Wj5eUpodY2GX+fkxMvK9EwI061ReBpJvAWhFu3SBxYiAjn3bvu+h+MbplwWtNCNlsMbzIl8CUlibzRKB8xm+WRHNbrk4MsGz/m8sQGG5wS4rodo6kKsGom+JRmhCaEXfEzYS56Jty4iSx406sWm9fj2z2CkM0G/uJF+A0G8EYjRszm5RzW6xFkWfzxcCAdDJjrfcis5IvoSr6FruRrccuo3W817s22lmhzntcekHorjuPzLQsVqq8HbzLBX1y8Io3sBgOGCwsRrKnBtLsJdRcMFBLl0CqQsEdD78jaKk7+BznWUcmflisoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cache-aside\"\n        title=\"cache-aside\"\n        src=\"/blog/static/c6a2425e60d48e817d76a0be14bf785d/f058b/cache-aside.png\"\n        srcset=\"/blog/static/c6a2425e60d48e817d76a0be14bf785d/c26ae/cache-aside.png 158w,\n/blog/static/c6a2425e60d48e817d76a0be14bf785d/6bdcf/cache-aside.png 315w,\n/blog/static/c6a2425e60d48e817d76a0be14bf785d/f058b/cache-aside.png 630w,\n/blog/static/c6a2425e60d48e817d76a0be14bf785d/5e3a3/cache-aside.png 763w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>read-through pattern:</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/6f6b76685ece0e223e0e8bc719473b2b/5e3a3/read-through.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB40lEQVQY0x2OT0iTcRyHP+/mRvG6ZdNI3gjCktr7ptOJS4QgDx3KYtFElGQJxho71EHy91ulkhFURIQW0y3/vKDkn7Kxkdnq5LpEEQjRsQ7v66VshxWUzvf9xvzAw3N4Lh8AqAIgAXAUbbXAAyv2oLhWCEP+rLD0KwPVm0da/YJnjZpAw8BGsAMvIneBAYLCNMhch8x0gFL1tTRb5aGFQ1561bBvMAzgqhPCdAXwEbgZyGCZklbVm69Zer5qn/N9B91z4u/FTmTDUeAxCQrTAjLXmcz0ZhgTLsOM2wwzbidzqvIp3QAOx4RyMS7twiQcbTOR0nFX4eWY3aDE7kJmOZwt+xk6LX7qiToo6Cu90Lsiubm+qjAtLzNtHmZi55YZwybFQH9UabEit1XWtXi8unOhvbppzSk96lk5FbdQMdOYxaS3bZ8jvx92N35jt1py0d6W+aFpn5uvjShMUxWm9cOcdBEl7NsYU5UTuTsAiIAM0DTqx/oslSTKN1Lx7Yeb72ZC6yLOEVJdoyUYJxzgP0SF609kridlrvfhzWDN2SR3t6evH+n4cL9OTodtCPXvEJAGus8PW0YavuIKvyb21c35A2eC+28ffY9WW0H4d/kBXjc7MACg/tiJg56Tl2q9HmXvf0MAyKK2raAxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"read-through\"\n        title=\"read-through\"\n        src=\"/blog/static/6f6b76685ece0e223e0e8bc719473b2b/f058b/read-through.png\"\n        srcset=\"/blog/static/6f6b76685ece0e223e0e8bc719473b2b/c26ae/read-through.png 158w,\n/blog/static/6f6b76685ece0e223e0e8bc719473b2b/6bdcf/read-through.png 315w,\n/blog/static/6f6b76685ece0e223e0e8bc719473b2b/f058b/read-through.png 630w,\n/blog/static/6f6b76685ece0e223e0e8bc719473b2b/5e3a3/read-through.png 763w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>write-through pattern:</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/e9becdf51ce8828e9cd89bb5a6aae481/5e3a3/write-through.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2ElEQVQY0y2QTWjTcByG33Q0YDtw/aAdTieyauc/tsmSrd1CqaLoEDYU58dOnhTxUNxBlyiMIQ4F8QPEsdmGtcMhtBdrFbbJDsKY4kEZCsOLB030rGGnzOQnFV94eM7PCwA7ALQDaAXQ0eKDBHAx/N/T3G/ujb2KednG8/InPBQ3OKhAtjsBcfAymG6BaSaEf7YAavSkqdolUjWh0KLSoQ0FgZCAjKJibYCwkLOxRist87Kdqtc+8vfEdSALZNg+SPmTYPpPH9PMEaZbGtMsFe5c2PWKftcr8uRW4gYRcDq/s03tzW0nIiw1vviNiPPiCe+SEdpavnWuFo4nA8FsZjDUF0VA0L5FmG59ZpppM82swStt++PNwKFZ0OZs2wLwIHy4P5lQlfxeyAhcV6vDj/2bNI0teuT/RTf7Xo+iF7EB5UhSYZ2d0vHCAeHa1xmm/6gwzZyAVw4TlXjymlTa575rzecI2AMYE6t49WyDNyJOo8i7VAo5K4sFJ3jp2BQQBdKnpprJrUy3pplu1ZlujWN5MjVc1/effXmje/T9XYktjXGYPBPlpIMx3JHfcvf7P6CgXw2OS9UTI0Pnd91OvcMVoezbLQcgjK3jIoCe7KEu8eiFtCwK8b8vsrMKWavRIAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"write-through\"\n        title=\"write-through\"\n        src=\"/blog/static/e9becdf51ce8828e9cd89bb5a6aae481/f058b/write-through.png\"\n        srcset=\"/blog/static/e9becdf51ce8828e9cd89bb5a6aae481/c26ae/write-through.png 158w,\n/blog/static/e9becdf51ce8828e9cd89bb5a6aae481/6bdcf/write-through.png 315w,\n/blog/static/e9becdf51ce8828e9cd89bb5a6aae481/f058b/write-through.png 630w,\n/blog/static/e9becdf51ce8828e9cd89bb5a6aae481/5e3a3/write-through.png 763w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>👨‍🔧: với caching ta sẽ improve được application perfomance, giảm thiểu chi phí I/O ở database, giảm i/O ở backend application,</p>\n<p>👳‍♂️: …</p>\n<p>👨‍🦳: …</p>\n<h3>Phần 4: Consistent Hashing</h3>\n<h3>Phần 5: Thiết kế một ứng dụng</h3>","frontmatter":{"title":"System design interview","date":"July 06, 2020","description":"Trải niệm khi đi phỏng vấn về system design, và tôi đã thất bại như thế nào."}},"previous":{"fields":{"slug":"/new-beginnings/"},"frontmatter":{"title":"JavaScript Architecture Application"}},"next":{"fields":{"slug":"/ts-design-pattern/"},"frontmatter":{"title":"💎 TS Design Pattern"}}},"pageContext":{"id":"50caf298-0738-52ab-9799-10a6a28cd5c7","previousPostId":"015713ba-9a83-5156-ba51-a6487d4fa8a0","nextPostId":"f596e98a-3203-5f47-882d-5ffe4e597b0e"}},"staticQueryHashes":["2841359383","3257411868"]}